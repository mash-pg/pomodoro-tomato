# Gemini CLI Tomato

このプロジェクトは[`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app)でブートストラップされた[Next.js](https://nextjs.org)プロジェクトです。

## ✨ 機能

このアプリケーションは、生産性を向上させるために設計された多機能ポモドーロタイマーです。以下の機能が含まれています。

### 1. ポモドーロタイマー

このアプリケーションの中核機能です。作業セッション、短い休憩、長い休憩の時間をカスタマイズできます。

```
+---------------------------------+
|            ポモドーロ             |
|                                 |
|             25:00               |
|                                 |
|      [ スタート ] [ リセット ]      |
|                                 |
|   今日の合計: 4ポモドーロ / 100分   |
+---------------------------------+
```

### 2. 統計ページ

詳細な統計で進捗を追跡します。日次、週次、月次の目標を設定し、活動パターンをグラフで確認できます。

```
+---------------------------------+
|           あなたの統計            |
|                                 |
| 今日:      [ 5/8 ] ポモドーロ     |
| 今週:      [ 25/40 ] ポモドーロ   |
| 今月:      [ 100/160 ] ポモドーロ |
|                                 |
| [ 最近のセッション... ]         |
| [ 手動で追加...    ]         |
+---------------------------------+
```

### 3. カレンダー表示

月間カレンダーで過去の活動を振り返ることができます。各日に完了したポモドーロの数が表示されます。

```
+---------------------------------+
|        ポモドーロカレンダー         |
|                                 |
|      <   2025年8月   >        |
|  日  月  火  水  木  金  土     |
|                  1   2 (8)      |
|   3   4   5   6   7   8   9     |
|  10  11  12 (5) 13  14  15     |
|  ...                            |
+---------------------------------+
```

### 4. 週時間カレンダー

ポモドーロセッションを時間単位で可視化する、レスポンシブ対応の週間カレンダーです。画面サイズに応じてレイアウトが変化します。

**PC表示:**
```
+----------------------------------------------------------------------------------------------------+
|                                       週ごとのポモドーロ (時間)                                      |
+----------------------------------------------------------------------------------------------------+
| < 前の週                      YYYY年MM月DD日 - YYYY年MM月DD日                       次の週 >     |
+----------------------------------------------------------------------------------------------------+
|      日          月          火          水          木          金          土             |
|    MM/DD        MM/DD        MM/DD        MM/DD        MM/DD        MM/DD        MM/DD           |
|     8.5h         7.0h         9.2h         6.5h         8.0h         5.5h         10.0h          |
+----------------------------------------------------------------------------------------------------+
```

### 5. ユーザー認証と設定

サインアップとログインで、複数のデバイス間でデータを同期できます。タイマーの時間、自動開始の有無、テーマ（ダーク/ライト）などをカスタマイズ可能です。

```
+---------------------------------+
|              設定               |
|                                 |
| 作業時間:          [ 25 ] 分    |
| 短い休憩:          [ 5  ] 分    |
| 長い休憩:          [ 15 ] 分    |
|                                 |
| 休憩を自動で開始:    [ オン/オフ ]   |
| テーマ:              [ ダーク/ライト ] |
+---------------------------------+
```

## 🔐 ユーザー認証フロー

本アプリケーションはSupabase Authを利用して、安全なユーザー認証を実現しています。

### 新規登録
1.  ユーザーは`/signup`ページでメールアドレスとパスワードを入力します。
2.  `AuthForm`コンポーネントが入力値を受け取り、Supabaseの`signUp`メソッドを呼び出します。
3.  登録が成功すると、Supabaseは確認メールをユーザーに送信します。
4.  同時に、`handle_new_user`トリガーが実行され、`user_settings`と`user_goals`テーブルに新しいユーザー用のデフォルトデータが作成されます。

### ログイン
1.  ユーザーは`/login`ページでメールアドレスとパスワードを入力します。
2.  `AuthForm`コンポーネントがSupabaseの`signInWithPassword`メソッドを呼び出します。
3.  認証が成功すると、セッションが作成され、ユーザーはアプリケーションのメイン機能にアクセスできるようになります。

**注意:** Supabaseのデフォルト設定では、新規登録後にメール認証が必要です。テスト環境では、Supabaseダッシュボードの **Authentication** > **Settings** で **Disable email confirmations** を有効にすることで、このステップを省略できます。

## 🛠️ 技術スタック

*   **フレームワーク**: [Next.js](https://nextjs.org/)
*   **言語**: [TypeScript](https://www.typescriptlang.org/)
*   **スタイリング**: [Tailwind CSS](https://tailwindcss.com/)
*   **UIコンポーネント**: [React Calendar](https://github.com/wojtekmaj/react-calendar)
*   **チャート**: [Recharts](https://recharts.org/)
*   **データベース**: [Supabase](https://supabase.io/)
*   **テスト**: [Jest](https://jestjs.io/), [React Testing Library](https://testing-library.com/docs/react-testing-library/intro/)
*   **PWA**: [next-pwa](https://www.npmjs.com/package/next-pwa)
*   **デプロイ**: [Vercel](https://vercel.com/)

## 🚀 Getting Started

まず、開発サーバーを起動します:

```bash
npm run dev
# or
yarn dev
```

ブラウザで[http://localhost:3000](http://localhost:3000)を開いて結果を確認します。

## 📦 セットアップとデプロイ

### 1. Supabase プロジェクトのセットアップ

1.  [Supabase](https://supabase.com/)にサインアップし、新しいプロジェクトを作成します。
2.  プロジェクトのダッシュボードで、**SQL Editor**に移動します。
3.  `sql/schema.sql`と`sql/user_goals.sql`を実行してデータベースをセットアップします。
4.  **Settings** > **API** に移動し、`Project URL`と`anon` `public`キーを控えておきます。

### 2. ローカルでの実行

#### 前提条件
*   [Node.js](https://nodejs.org/) (v18.x or later)
*   [npm](https://www.npmjs.com/) or [Yarn](https://yarnpkg.com/)

#### インストール
1.  **リポジトリをクローンする**: `git clone https://github.com/your-username/gemini-cli-tomato.git`
2.  **依存関係をインストールする**: `npm install` or `yarn install`
3.  **環境変数を設定する**: `.env.local`ファイルを作成し、Supabaseのキーを設定します。
    ```
    NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
    NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
    ```
4.  **開発サーバーを起動する**: `npm run dev` or `yarn dev`

### 3. Vercel へのデプロイ

1.  リポジトリをGitHubにプッシュします。
2.  [Vercel](https://vercel.com/)でプロジェクトを作成し、リポジトリを連携します。
3.  環境変数にSupabaseのキーを設定してデプロイします。

## 📱 PWA (Progressive Web App)

このアプリケーションはPWAに対応しており、オフラインでの利用や、スマートフォンやPCのホーム画面にインストールしてネイティブアプリのように使用することができます。

本番環境でサイトにアクセスすると、ブラウザのアドレスバーにインストールアイコンが表示されます。

## 🧪 テスト

JestとReact Testing Libraryを使用した単体テストとコンポーネントテストが含まれています。

*   **テストの実行**: `npm test` or `yarn test`
*   **テストファイル**: テストは`tests/`ディレクトリ内にコンポーネントごとに配置されています。

## 🎨 スタイルのカスタマイズ

スタイリングにはTailwind CSSを使用しています。`tailwind.config.mjs`ファイルを編集することで、カラーパレット、フォント、ブレークポイントなどのデザインシステムをカスタマイズできます。

## 🤔 トラブルシューティング

*   **Supabaseへの接続エラー**: `.env.local`ファイルのURLとキーが正しいか確認してください。また、Supabaseプロジェクトのステータスが正常であるか確認してください。
*   **ビルドエラー**: 依存関係が正しくインストールされているか確認してください。`node_modules`と`.next`ディレクトリを削除し、`npm install`を再実行すると解決する場合があります。

## 📂 ディレクトリ構成

```
.
├── sql/                # データベーススキーマと初期データ
├── src/                # ソースコード
│   ├── app/            # Next.js App Router
│   ├── components/     # 再利用可能なReactコンポーネント
│   └── lib/            # ヘルパー関数とライブラリ
└── ...
```

## 🗄️ データベースとログ

### スキーマ

このプロジェクトはSupabaseをバックエンドとして使用しています。データベースには以下のテーブルが含まれます。

*   `user_settings`: ユーザーごとのタイマー設定を保存します。
*   `pomodoro_sessions`: 完了したポモドーロセッションの記録を保存します。
*   `user_goals`: ユーザーが設定した日次、週次、月次の目標を保存します。

すべてのテーブルはRow Level Security (RLS) が有効になっており、ユーザーは自身のデータにのみアクセスできます。

### ログの確認

*   **Supabase**: Supabaseダッシュボードの **Logs** > **PostgREST Logs** からAPIリクエストのログを確認できます。データベースに関する問題は **Database** > **Logs** で確認可能です。
*   **Vercel**: Vercelのプロジェクトダッシュボードの **Logs** タブから、リアルタイムのアプリケーションログ（ビルドログ、関数ログなど）を確認できます。

## 🤝 コントリビューション

コントリビューションを歓迎します！Issueの作成やプルリクエストの送信を気軽に行ってください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。詳細は[LICENSE](LICENSE)ファイルをご覧ください。
